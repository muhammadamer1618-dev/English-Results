<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>شهادة الطالب - مدارس الفلاح الأهلية</title>
<link href='https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap' rel='stylesheet'>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Calibri;background:#f6f6f6;margin:0;padding:25px}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:22px}
td{border:1px solid #000;padding:10px;text-align:center}
.label{color:#d32f2f;font-weight:bold}
.value{color:#1565c0;font-weight:bold}
.title{text-align:center;font-size:26px;color:#d32f2f;font-weight:bold;padding:10px;border:1px solid #000;margin-top:10px}
.btn{width:100%;padding:15px;border:none;border-radius:8px;font-size:18px;margin-bottom:10px;cursor:pointer}
.view{background:#1976d2;color:white}
.print{background:#388e3c;color:white}
.back{background:#777;color:white}
@media print{.btn,#code{display:none}}
</style>
</head>
<body>

<input id="code" placeholder="ادخل كود الطالب" class="btn" style="border:1px solid #999">
<button onclick="loadData()" class="btn view">عرض</button>
<button onclick="window.print()" class="btn print">طباعة</button>
<button onclick="location='index.html'" class="btn back">الصفحة الرئيسية</button>

<div id="cert" style="display:none">

<h1 style="text-align:center;color:#1565c0;font-size:34px;margin:0;font-weight:bold;">
    مدارس الفلاح الأهلية
</h1>

<h2 style="text-align:center;color:#d32f2f;font-size:26px;margin-top:5px;font-weight:bold;">
    قسم اللغة الإنجليزية
</h2>

<div class="title">شهادة درجات مادة اللغة الإنجليزية</div>

<table>
<tr><td class="label">اسم الطالب</td><td class="value" id="student_name"></td></tr>
<tr><td class="label">الصف</td><td class="value" id="grade"></td></tr>
<tr><td class="label">الشعبة</td><td class="value" id="section"></td></tr>
<tr><td class="label">اختبار</td><td class="value" id="examType"></td></tr>
<tr><td class="label">الدرجة النهائية</td><td class="value" id="fullMark"></td></tr>
<tr><td class="label">درجة الطالب</td><td class="value" id="mark"></td></tr>
<tr><td class="label">التقدير</td><td class="value" id="rating"></td></tr>
</table>

<table>
<tr>
<td class="label">معلم المادة</td>
<td class="label">مشرف المادة</td>
<td class="label">رئيس قسم الإشراف</td>
<td class="label">مدير المدرسة</td>
</tr>
<tr>
<td class="value" id="teacher_fixed"></td>
<td class="value">محمد عامر أحمد</td>
<td class="value">أحمد سمير عباس</td>
<td class="value">سعيد بن علي الجمعان</td>
</tr>
</table>

</div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyCX-KNQTu0Y1tnTGWd1sKtXLDUmR7Tehek",
  authDomain: "english-results.firebaseapp.com",
  projectId: "english-results",
  storageBucket: "english-results.firebasestorage.app",
  messagingSenderId: "673616902884",
  appId: "1:673616902884:web:62c38d39a3c1a0694a4af1"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

function calcRating(mark, full){
 let m = Number(mark);
 let f = Number(full);
 if(!m || !f) return "—";
 let p = (m/f)*100;
 if(p>=90) return "ممتاز";
 if(p>=80) return "جيد جدًا";
 if(p>=70) return "جيد";
 if(p>=60) return "مقبول";
 return "ضعيف";
}

async function loadData(){
 let c = document.getElementById('code').value.trim();
 if(!c){
   alert("ادخل كود الطالب");
   return;
 }

 try{
   var doc = await db.collection("students").doc(c).get();
   if(!doc.exists){
     alert("الكود غير موجود");
     return;
   }
   var st = doc.data();

   document.getElementById('cert').style.display="block";

   document.getElementById('student_name').innerText = st.name || "";
   document.getElementById('grade').innerText = st.grade || "";
   document.getElementById('section').innerText = st.section || "";
   document.getElementById('examType').innerText = st.examType ? ("اختبار " + st.examType) : "";
   document.getElementById('fullMark').innerText = st.fullMark || "";
   document.getElementById('mark').innerText = (st.mark !== undefined && st.mark !== null) ? st.mark : "";
   document.getElementById('teacher_fixed').innerText = st.teacher || "";

   document.getElementById('rating').innerText = calcRating(st.mark, st.fullMark);
 }catch(e){
   alert("خطأ في قراءة بيانات الطالب");
   console.log(e);
 }
}
</script>

</body>
</html>
