<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إدارة الطلاب</title>
<link href='https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap' rel='stylesheet'>
<style>
body{font-family:Calibri;background:#fafafa;padding:20px;margin:0}
h2{text-align:center;color:#1976d2}
table{width:100%;border-collapse:collapse;margin-top:20px}
td,th{border:1px solid #000;padding:10px;text-align:center}
th{background:#1976d2;color:white}
button.small{padding:5px 10px;font-size:14px;border:none;border-radius:5px;background:#1976d2;color:white;cursor:pointer}
button.delete{background:#d32f2f !important}
.main-btn{padding:10px 15px;font-size:16px;border:none;border-radius:8px;background:#1976d2;color:white;cursor:pointer;margin-top:15px}
</style>
</head>
<body>

<h2>إدارة الطلاب</h2>

<table id="tbl">
<tr>
<th>الكود</th>
<th>الاسم</th>
<th>الصف</th>
<th>المعلم</th>
<th>خيارات</th>
</tr>
</table>

<button class="main-btn" onclick="location='admin.html'">إضافة طالب</button>
<button class="main-btn" onclick="location='index.html'">الصفحة الرئيسية</button>

<script>
// إعداد Firebase
var firebaseConfig = {
  apiKey: "AIzaSyCX-KNQTu0Y1tnTGWd1sKtXLDUmR7Tehek",
  authDomain: "english-results.firebaseapp.com",
  projectId: "english-results",
  storageBucket: "english-results.firebasestorage.app",
  messagingSenderId: "673616902884",
  appId: "1:673616902884:web:62c38d39a3c1a0694a4af1"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

async function load(){
  let tbl = document.getElementById("tbl");

  try {
    // تحميل الطلاب من Firebase
    var snapshot = await db.collection("students").get();
    
    snapshot.forEach(doc => {
      var student = doc.data();
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${doc.id}</td>
        <td>${student.name || ""}</td>
        <td>${student.grade || ""}</td>
        <td>${student.teacher || ""}</td>
        <td>
          <button class="small" onclick="edit('${doc.id}')">تعديل</button>
          <button class="small delete" onclick="delStd('${doc.id}')">حذف</button>
        </td>
      `;
      tbl.appendChild(tr);
    });
  } catch (e) {
    alert("حدث خطأ في تحميل الطلاب");
    console.log(e);
  }
}

function edit(code){
  localStorage.setItem("editStudent", code);
  location="admin.html";
}

async function delStd(code){
  if(!confirm("هل تريد حذف هذا الطالب؟")) return;

  try {
    // حذف الطالب من Firebase
    await db.collection("students").doc(code).delete();

    alert("تم حذف الطالب بنجاح");
    location.reload();
  } catch (e) {
    alert("حدث خطأ أثناء حذف الطالب");
    console.log(e);
  }
}

load();
</script>

</body>
</html>
