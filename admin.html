<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>صفحة المشرف - مدارس الفلاح الأهلية</title>
    <link href="https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap" rel="stylesheet">

    <!-- Firebase compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: Calibri; background: #f4f4f4; margin: 0; padding: 20px; }
        .header { background: #1976d2; color: #fff; padding: 15px; text-align: center; }
        .header h1 { margin: 0; font-size: 26px; }
        .header h2 { margin: 5px 0; font-size: 20px; color: #ffeb3b; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }
        .btn { padding: 10px 20px; font-size: 16px; margin: 10px; background-color: #1976d2; color: white; border: none; cursor: pointer; }
        .btn:hover { background-color: #1565c0; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 18px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #1976d2; color: white; }
        .result { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>مدارس الفلاح الأهلية</h1>
        <h2>لوحة المشرف</h2>
    </div>

    <div class="container">
        <h3>إدخال بيانات الطالب</h3>
        <label>أدخل كود الطالب:</label>
        <input id="studentCode" type="text" placeholder="أدخل كود الطالب هنا">
        <button class="btn" onclick="loadStudentData()">عرض بيانات الطالب</button>

        <div class="result" id="studentData" style="display: none;">
            <table>
                <tr><th>اسم الطالب</th><td id="studentName"></td></tr>
                <tr><th>الصف</th><td id="studentGrade"></td></tr>
                <tr><th>المادة</th><td id="subject"></td></tr> <!-- تم إضافة حقل المادة هنا -->
                <tr><th>درجة الطالب</th><td id="studentMark"></td></tr>
                <tr><th>الدرجة النهائية</th><td id="finalMark"></td></tr>
                <tr><th>التقدير</th><td id="rating"></td></tr>
            </table>
        </div>

        <h3>تعديل بيانات الطالب:</h3>
        <input type="text" id="newSubject" placeholder="أدخل اسم المادة هنا"> <!-- خانة المادة التي يتم إدخالها -->
        <button class="btn" onclick="saveStudent()">حفظ بيانات الطالب</button>
    </div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCX-KNQTu0Y1tnTGWd1sKtXLDUmR7Tehek",
            authDomain: "english-results.firebaseapp.com",
            projectId: "english-results",
            storageBucket: "english-results.firebasestorage.app",
            messagingSenderId: "673616902884",
            appId: "1:673616902884:web:62c38d39a3c1a0694a4af1"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();

        // دالة لحساب التقدير بناءً على درجة الطالب
        function calculateRating(mark, fullMark) {
            var percentage = (mark / fullMark) * 100;
            if (percentage >= 90) return "ممتاز";
            if (percentage >= 80) return "جيد جداً";
            if (percentage >= 70) return "جيد";
            if (percentage >= 60) return "مقبول";
            return "ضعيف";
        }

        // دالة لتحميل بيانات الطالب
        function loadStudentData() {
            var code = document.getElementById("studentCode").value.trim();
            if (!code) {
                alert("الرجاء إدخال كود الطالب");
                return;
            }

            db.collection("students").doc(code).get().then(function(doc) {
                if (doc.exists) {
                    var studentData = doc.data();
                    document.getElementById("studentName").innerText = studentData.name || "غير متوفر";
                    document.getElementById("studentGrade").innerText = studentData.grade || "غير متوفر";
                    document.getElementById("subject").innerText = studentData.subject || "غير متوفر"; // المادة التي تم إدخالها
                    document.getElementById("studentMark").innerText = studentData.mark || "غير متوفر";
                    document.getElementById("finalMark").innerText = studentData.fullMark || "غير متوفر";
                    document.getElementById("rating").innerText = calculateRating(studentData.mark, studentData.fullMark);
                    document.getElementById("studentData").style.display = "block";
                } else {
                    alert("الطالب غير موجود");
                }
            }).catch(function(error) {
                console.error("Error getting document:", error);
            });
        }

        // دالة لحفظ بيانات الطالب
        function saveStudent() {
            var code = document.getElementById("studentCode").value.trim();
            var newSubject = document.getElementById("newSubject").value.trim();
            var name = document.getElementById("studentName").innerText;
            var grade = document.getElementById("studentGrade").innerText;
            var mark = document.getElementById("studentMark").innerText;
            var fullMark = document.getElementById("finalMark").innerText;

            if (!name || !grade || !newSubject || !mark || !fullMark) {
                alert("برجاء إدخال كافة البيانات");
                return;
            }

            var studentData = {
                name: name,
                grade: grade,
                subject: newSubject, // حفظ المادة التي تم إدخالها
                mark: mark,
                fullMark: fullMark
            };

            db.collection("students").doc(code).set(studentData, { merge: true })
            .then(function() {
                alert("تم حفظ بيانات الطالب");
            }).catch(function(error) {
                console.error("خطأ في حفظ البيانات: ", error);
            });
        }
    </script>
</body>
</html>
