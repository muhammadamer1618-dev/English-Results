<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>درجات الاختبار</title>
<link href='https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap' rel='stylesheet'>
<style>
body{font-family:Calibri;background:#eef;padding:20px;margin:0}
h2{text-align:center;color:#1976d2}
input,button{
    width:100%;padding:15px;margin-top:10px;
    font-size:18px;border:1px solid #999;border-radius:8px;
}
button{background:#1976d2;color:white;border:none;cursor:pointer}
</style>
</head>
<body>

<h2>إدخال درجات الاختبار</h2>

<input id="code" placeholder="كود الطالب">
<input id="examType" placeholder="نوع الاختبار (نهائي / فترة / قصير)">
<input id="fullMark" placeholder="الدرجة النهائية">
<input id="mark" placeholder="درجة الطالب">
<select id="subject">
    <option value="رياضيات">رياضيات</option>
    <option value="إنجليزي">إنجليزي</option>
    <option value="علوم">علوم</option>
    <option value="تاريخ">تاريخ</option>
    <option value="جغرافيا">جغرافيا</option>
    <option value="فيزياء">فيزياء</option>
    <option value="كيمياء">كيمياء</option>
</select>

<button onclick="saveScore()">حفظ الدرجات</button>
<button onclick="location='index.html'">الصفحة الرئيسية</button>

<script>
// إعداد Firebase
var firebaseConfig = {
    apiKey: "AIzaSyCX-KNQTu0Y1tnTGWd1sKtXLDUmR7Tehek",
    authDomain: "english-results.firebaseapp.com",
    projectId: "english-results",
    storageBucket: "english-results.firebasestorage.app",
    messagingSenderId: "673616902884",
    appId: "1:673616902884:web:62c38d39a3c1a0694a4af1"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

async function saveScore(){
    let codeInput = document.getElementById('code').value.trim();
    let examInput = document.getElementById('examType').value.trim();
    let fullInput = document.getElementById('fullMark').value.trim();
    let markInput = document.getElementById('mark').value.trim();
    let subjectInput = document.getElementById('subject').value;

    // التأكد من وجود المدخلات
    if (!codeInput || !examInput || !fullInput || !markInput) {
        alert("يرجى ملء جميع الحقول");
        return;
    }

    try {
        // البحث عن الطالب في Firebase باستخدام الكود
        var studentRef = db.collection("students").doc(codeInput);
        var doc = await studentRef.get();

        if (!doc.exists) {
            alert("الطالب غير موجود");
            return;
        }

        // تحديث بيانات الطالب في Firebase
        await studentRef.update({
            [`subjects.${subjectInput}.examType`]: examInput,
            [`subjects.${subjectInput}.fullMark`]: Number(fullInput),
            [`subjects.${subjectInput}.mark`]: Number(markInput)
        });

        alert("تم حفظ درجات الطالب");

    } catch (e) {
        alert("حدث خطأ في حفظ الدرجات");
        console.log(e);
    }
}
</script>

</body>
</html>
